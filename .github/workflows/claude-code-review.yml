name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened]
    paths:
      - "**/*.py"

jobs:
  claude-review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
      issues: read
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Run Claude Code Review
        id: claude-review
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          prompt: |
            REPO: ${{ github.repository }}
            PR NUMBER: ${{ github.event.pull_request.number }}

            Please review this pull request focusing on:

            **Code Quality & Correctness:**
            - Logic errors or bugs
            - Edge cases not handled
            - Potential runtime errors
            - Code that doesn't match its documentation

            **Best Practices:**
            - Code organization and structure
            - Error handling
            - Performance issues
            - Maintainability concerns

            Use the repository's CLAUDE.md for guidance on the codebase architecture.

            Be specific about any issues found, including file paths and line numbers.
            If the code looks good, briefly confirm the changes are sound.

            Use `gh pr comment` with your Bash tool to leave your review as a comment on the PR.

          claude_args: '--allowed-tools "Bash(gh issue view:*),Bash(gh search:*),Bash(gh issue list:*),Bash(gh pr comment:*),Bash(gh pr diff:*),Bash(gh pr view:*),Bash(gh pr list:*)"'
