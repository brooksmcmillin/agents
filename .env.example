# ============================================================================
# MULTI-AGENT SYSTEM CONFIGURATION
# ============================================================================
# Copy this file to .env and fill in your actual values
# Never commit .env to version control

# ============================================================================
# REQUIRED - Claude API
# ============================================================================
# Get your API key from: https://console.anthropic.com/
# Required for: ALL agents (pr_agent, task_manager)
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# ============================================================================
# LOCAL MCP SERVER (Optional)
# ============================================================================
# For running MCP server locally via HTTP/SSE transport
# Only needed if you run: uv run python -m mcp_server.server_http
MCP_SERVER_HOST=localhost
MCP_SERVER_PORT=8000

# ============================================================================
# REMOTE MCP SERVER (Task Manager & Notifier)
# ============================================================================
# Required for: task_manager agent, notifier script
# The remote MCP server provides task management tools

# Server URL
MCP_SERVER_URL=https://mcp.brooksmcmillin.com/mcp

# Authentication Method 1: Manual Token (Simpler)
# Get a token from: uv run python scripts/mcp_auth.py
# Uncomment and set this to use manual token authentication:
#MCP_AUTH_TOKEN=your_manual_token_here

# Authentication Method 2: OAuth (Automatic - Recommended)
# The RemoteMCPClient supports automatic OAuth authentication.
# If MCP_AUTH_TOKEN is NOT set above, the client will:
#   1. Discover OAuth configuration from the server
#   2. Open your browser for authentication
#   3. Save tokens automatically for future use
# Register callback URL in your OAuth provider: http://localhost:8889/callback

MCP_AUTHORIZE_URL=https://todo.brooksmcmillin.com/authorize
MCP_TOKEN_URL=https://todo.brooksmcmillin.com/oauth/token
MCP_CLIENT_ID=your_mcp_client_id
MCP_CLIENT_SECRET=your_mcp_client_secret
MCP_OAUTH_SCOPE=mcp:read mcp:write

# ============================================================================
# SLACK INTEGRATION (Notifier)
# ============================================================================
# Required for: notifier script
# Get webhook URL from: https://api.slack.com/messaging/webhooks
# The notifier sends task updates to Slack

SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# ============================================================================
# FASTMAIL EMAIL INTEGRATION
# ============================================================================
# Required for: email tools (send_email, send_agent_report, etc.)
# Get your API token from: FastMail Settings -> Privacy & Security -> Integrations -> API tokens

FASTMAIL_API_TOKEN=your_fastmail_api_token_here

# ============================================================================
# AGENT EMAIL REPORTS
# ============================================================================
# Configuration for agents to send reports/notifications via email
# Each agent sends from {agent_name}@{domain} to the admin email

# Required: Admin email address where agent reports are sent
ADMIN_EMAIL_ADDRESS=you@example.com

# Optional: Domain for agent email addresses (default: brooksmcmillin.com)
# Each agent will send from: chatbot@yourdomain.com, pr-agent@yourdomain.com, etc.
# Make sure to configure these as identities in your FastMail account
AGENT_EMAIL_DOMAIN=brooksmcmillin.com

# Optional: Email intake agent address (for receiving task requests via email)
# The email intake agent monitors this address for emails from ADMIN_EMAIL_ADDRESS
# and routes tasks to appropriate agents, then replies with results
#INTAKE_EMAIL_ADDRESS=tasks@yourdomain.com

# ============================================================================
# GITHUB MCP SERVER (Business Advisor)
# ============================================================================
# Required for: business_advisor agent
# The GitHub MCP server provides repository analysis tools
# Get a Personal Access Token from: https://github.com/settings/tokens
# Required scopes: repo (read access)

GITHUB_MCP_PAT=...

# ============================================================================
# SOCIAL MEDIA APIs (Future - Not Yet Connected)
# ============================================================================
# These are configured but not yet connected to real APIs
# The tools currently return mock data
# For future integration with real Twitter/LinkedIn APIs

# Twitter/X API
# Get credentials from: https://developer.twitter.com/
TWITTER_CLIENT_ID=your_twitter_client_id
TWITTER_CLIENT_SECRET=your_twitter_client_secret

# LinkedIn API
# Get credentials from: https://www.linkedin.com/developers/
LINKEDIN_CLIENT_ID=your_linkedin_client_id
LINKEDIN_CLIENT_SECRET=your_linkedin_client_secret

# ============================================================================
# DATABASE (Persistence Features)
# ============================================================================
# PostgreSQL connection URL for persistent storage features:
# - Conversation history (chat sessions that survive restarts)
# - Memory storage (when MEMORY_BACKEND=database)
# - RAG documents (vector storage with pgvector)
#
# Format: postgresql://user:password@host:port/dbname  # pragma: allowlist secret
#
# Examples:
#   Local: postgresql://postgres:secret@localhost:5432/agents  # pragma: allowlist secret
#   Supabase: postgresql://user:password@db.xxxxx.supabase.co:5432/postgres  # pragma: allowlist secret
#   Neon: postgresql://user:password@ep-xxxxx.us-east-2.aws.neon.tech/agents  # pragma: allowlist secret
#   AWS RDS: postgresql://user:password@mydb.xxxxx.us-east-1.rds.amazonaws.com:5432/agents  # pragma: allowlist secret
#
# For secure connections, add SSL mode:
#   ?sslmode=require
#
# REQUIRED for Docker deployment. If set, enables:
#   - GET/POST /conversations endpoints in the REST API
#   - Persistent chat sessions across server restarts
#   - Message history retrieval and export

DATABASE_URL=postgresql://user:password@your-db-host:5432/agents  # pragma: allowlist secret

# Memory backend: "file" (default) or "database"
# If "database", uses DATABASE_URL for memory storage
MEMORY_BACKEND=file

# Optional: Separate URLs for memory and RAG storage
# (defaults to DATABASE_URL if not set)
# MEMORY_DATABASE_URL=postgresql://user:password@localhost:5432/agents
# RAG_DATABASE_URL=postgresql://user:password@localhost:5432/agents

# ============================================================================
# TOKEN STORAGE & ENCRYPTION
# ============================================================================
# Where to store OAuth tokens (file-based by default)
TOKEN_STORAGE_PATH=./tokens

# Encryption key for securing stored tokens
# Generate with: uv run python scripts/manage_tokens.py generate-key
# Leave empty to store tokens unencrypted (not recommended for production)
TOKEN_ENCRYPTION_KEY=generate_a_secure_key_here

# ============================================================================
# API SECURITY (Optional)
# ============================================================================
# API key authentication - if set, all expensive endpoints require
# Authorization: Bearer <API_KEY> header
#API_KEY=your_secret_api_key_here

# Rate limiting - set to true to enable request rate limiting
# Uses slowapi with default limits per endpoint
RATE_LIMIT_ENABLED=false

# ============================================================================
# LAKERA GUARD - Prompt Injection Detection (Optional)
# ============================================================================
# Lakera Guard screens LLM inputs for prompt injection and jailbreak attempts
# Get your API key from: https://platform.lakera.ai/
#
# If not set, security checks are skipped (fail-open)
#LAKERA_API_KEY=your_lakera_api_key_here
#LAKERA_PROJECT_ID=project-9146177048
#LAKERA_FAIL_OPEN=true

# ============================================================================
# LANGFUSE - Agent Observability (Optional)
# ============================================================================
# Langfuse provides tracing and monitoring for LLM applications.
# Track agent actions, tool calls, token usage, and latency.
# View traces and create dashboards/alerts.
#
# Option 1: Langfuse Cloud (Recommended for getting started)
#   Sign up at: https://cloud.langfuse.com
#   Get keys from: Project Settings > API Keys
#
# Option 2: Self-hosted Langfuse
#   Deploy from: https://langfuse.com/docs/deployment/self-host
#   Set LANGFUSE_HOST to your instance URL
#
# Set LANGFUSE_ENABLED=true and provide keys to enable tracing

LANGFUSE_ENABLED=false
#LANGFUSE_PUBLIC_KEY=pk-lf-...
#LANGFUSE_SECRET_KEY=sk-lf-...
# Regional endpoint or self-hosted URL (use either LANGFUSE_HOST or LANGFUSE_BASE_URL):
#LANGFUSE_BASE_URL=https://us.cloud.langfuse.com  # US region
#LANGFUSE_BASE_URL=https://eu.cloud.langfuse.com  # EU region
#LANGFUSE_BASE_URL=https://cloud.langfuse.com     # Default (EU)

# ============================================================================
# LOGGING
# ============================================================================
# Log level: DEBUG, INFO, WARNING, ERROR
LOG_LEVEL=INFO

# Log file location
LOG_FILE=pr_agent.log

# ============================================================================
# QUICK START GUIDE
# ============================================================================
# Minimal setup to get started:
#
# 1. Copy this file:
#    cp .env.example .env
#
# 2. Add your Anthropic API key (required for all agents):
#    ANTHROPIC_API_KEY=sk-ant-...
#
# 3. For PR Agent only:
#    You're done! Run: uv run python -m agents.pr_agent.main
#
# 4. For Task Manager:
#    Get MCP token: uv run python scripts/mcp_auth.py
#    Then run: uv run python -m agents.task_manager.main
#
# 5. For Notifier:
#    Add SLACK_WEBHOOK_URL (see Slack section above)
#    Get MCP token: uv run python scripts/mcp_auth.py
#    Then run: uv run python -m agents.notifier.main
#
# 6. For Business Advisor:
#    Add GITHUB_MCP_PAT (see GitHub MCP section above)
#    Then run: uv run python run_agent.py business
#
# 7. For REST API with persistent conversations:
#    Set DATABASE_URL (PostgreSQL) for conversation persistence
#    Then run: uv run python -m agents.api
#    API docs at: http://localhost:8080/docs
#
# 8. For Email Intake Agent:
#    Set INTAKE_EMAIL_ADDRESS and ADMIN_EMAIL_ADDRESS
#    Then run: uv run python -m agents.email_intake.main
#    Or with --dry-run to test without sending replies
#
# 9. Test everything:
#    uv run python demo.py
#
# See README.md for full documentation
